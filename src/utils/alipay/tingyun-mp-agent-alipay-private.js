const tingyunGM = require("./alipay-tingyun-gm.min.js")

/*AGENT_VERSION=1.3.11-sgcc.3*/
var TINGYUN_MP_ENV_CONFIG = {
    "test": {
        encImpl: tingyunGM,
        pubKey: "0475e60ab5b94860dad0c2d193551a8b7a628a611df332e23dfcb42f6ecc348653b8a49418e52ff8872b500eeaf8be8c43b7389d115e91b7432bb1c939e764d31a",
        sgcc_beacon: 'https://osg-apm.sgcc.com.cn:18084/track-mp',
        key: 'P54-bRBPcGU',
        id: '4gA5HRiCw8g',
        sampleRate: 1
    },
    "prod": {
        encImpl: tingyunGM,
        pubKey: "0475e60ab5b94860dad0c2d193551a8b7a628a611df332e23dfcb42f6ecc348653b8a49418e52ff8872b500eeaf8be8c43b7389d115e91b7432bb1c939e764d31a",
        sgcc_beacon: 'https://osg-apm.sgcc.com.cn:18084/track-mp',
        key: '4Nl_NnGbjwY',
        id: '4gA5HRiCw8g',
        sampleRate: 1
    }
}
"use strict"; var a = my; function r(t) { t = a.getStorageSync({ key: t }); return t && t.data } function o(t, e) { a.setStorageSync({ key: t, data: e }) } function t() { var t = a.getSystemInfoSync(); return t && (t.SDKVersion = a.SDKVersion), t } function i(t) { return t.status } function e() { return ["tradePay", "scan", "previewImage"] } function n() { return "request" } function l() { return +new Date } var c = [], p = { context: null, sgccTrackSid: null }, s = { networkType: "", system: t() }; function u(t) { c.push({ timestamp: l(), route: t }) } function d() { c = [] } function h() { return c.slice() } function f(t) { t && (s.rid = t) } var y = "recordTyTime", m = "TINGYUN_UID", g = "custom", v = "TRIGGER_LIFECYCLE", T = 20, b = "event", D = "request", _ = "api", S = "timer", A = 1500, x = !0, C = !0, k = 5, I = "TY_CONFIG", E = "TY_SAMPLING", q = "TY_SETDATA_THRESHOLD", O = "TY_SETDATA_TRACE", F = "TY_SETDATA_TRACEHINT", N = "TY_IGNORE_ERRCODES", M = "TY_SETDATA_TIME_INTERVAL", R = [500, 1500], j = 256, P = 256, L = "__ty_page_param", w = "__ty_component_hooked", H = "POST", K = "GET", U = "success", z = "fail", G = "hook_wxcloud", Y = "hook_wxcloud_callfunction", B = "hook_wxcloud_callcontainer", V = "__ty_enc_body__"; function $(e) { return function (t) { return "Array" === e && Array.isArray ? Array.isArray(t) : Object.prototype.toString.call(t) === "[object " + e + "]" } } var J = $("String"), X = $("Array"), Z = $("Function"), Q = $("Object"), W = $("Boolean"), tt = $("Number"); function et(t, e) { var n = "", r = !1; try { n = JSON.stringify(t) } catch (t) { r = !(n = "") } return e ? { error: r, value: n } : n } function nt(t) { return t + "" } function rt(t) { return t ? Q(t) ? et(t).length : J(t) ? t.length : t instanceof ArrayBuffer ? t.byteLength : t.length || 0 : 0 } function at(t, e) { t = Q(t) ? et(t) : J(t) ? t : ""; return t = e ? t.substring(0, e) : t } var ot, it, ct, st = function () { function t(t) { return t < 0 ? NaN : t <= 30 ? 0 | Math.random() * (1 << t) : t <= 53 ? (0 | Math.random() * (1 << 30)) + (0 | Math.random() * (1 << t - 30)) * (1 << 30) : NaN } function e(t, e) { for (var n = t.toString(16), r = e - n.length, a = "0"; 0 < r; r >>>= 1, a += a)1 & r && (n = a + n); return n } return function () { return e(t(32), 8) + e(t(16), 4) + e(16384 | t(12), 4) + e(32768 | t(14), 4) + e(t(48), 12) } }(), ut = ""; function dt() { return ut = ut || st() } function ht() { return l() + "_" + st() } function ft(t) { it = t.pubKey, ct = t.encImpl, lt(t) } function lt(t) { return ot = void 0 === ot ? !!(t.encImpl && t.encImpl.sm2Enc && t.encImpl.sm4Enc && t.encImpl.sm3Hash && t.pubKey) : ot } function pt(t) { if (!ot) return t; var e = t.url, n = t.body, r = t.bodySep, a = e, t = n; try { var o = { source: "mp" }, i = dt(), c = ht() + (r || "") + at(n); if (o.body = ct.sm4Enc(c, i), o.encKey = ct.sm2Enc(i, it), o.hash = ct.sm3Hash(c), e) { var s = e.indexOf("?"); if (-1 < s) try { var u = e.substring(s + 1), a = e.substring(0, s) + "?" + ct.sm4Enc(u, i) } catch (t) { } } o.body && o.encKey && o.hash && (t = o) } catch (t) { } return { url: a, body: t } } var yt = {}, mt = !1; function gt(t, e) { t[e] = null == t[e] || t[e] } function vt(t) { null == (yt = (yt = t || {}).env && "undefined" != typeof TINGYUN_MP_ENV_CONFIG ? TINGYUN_MP_ENV_CONFIG[yt.env] || {} : yt).requestFailMessageSize && (yt.requestFailMessageSize = P), null == yt.apiFailMessageSize && (yt.apiFailMessageSize = j), yt.releaseId && f(yt.releaseId), gt(yt, G), gt(yt, Y), gt(yt, B), ft(yt) } function Tt() { return mt } function bt(t) { mt = t } var Dt = n(); function _t(t) { this.size = t || 100, this.queue = [], this.running = !1 } _t.prototype.add = function (t) { this.queue.length >= this.size || (this.queue.push(t), this.running || (this.running = !0, this.run())) }, _t.prototype.run = function () { var t = this; this.handler(this.queue.shift(), function () { 0 < t.queue.length ? t.run() : t.running = !1 }) }, _t.prototype.handler = function (t, e) { var n = { url: t.url || "".concat(yt.beacon).concat(t.uri), method: t.method || H, _no_record: !0, success: function () { t.success && t.success.apply(this, arguments) }, fail: function () { t.fail && t.fail.apply(this, arguments) }, complete: function () { t.complete && t.complete.apply(this, arguments), e() } }; t.data && (n.data = t.data), t.header && (n.headers = Object.assign(n.headers || {}, t.header)), a[Dt](n) }; var St = new _t; function At(t, e) { return Object.prototype.hasOwnProperty.call(t, e) } function xt(t) { var e = r(I); if (e && Q(e)) return e[t] } function Ct(t) { var e = r(I); if (e && Q(e) || (e = {}), t) for (var n in t) At(t, n) && (e[n] = t[n]); o(I, e) } function kt(t, r) { var a = this, o = {}; t.forEach(function (t) { var e = t.key, n = t.storeKey, t = t.validFunc; !!t && t.call(a, r[e]) && (yt[e] = r[e], o[n] = r[e]) }), Ct(o) } var It = 6e5, Et = xt(E), qt = !1; function Ot(t) { return null != t && tt(t) } function Ft(t) { return null != t && W(t) } function Nt(t) { return null != t && X(t) } function Mt(t) { return Nt(t) && 2 == t.length } function Rt(t) { yt.key && yt.beacon && St.add({ uri: "/mp-config/config/pullSampling?encodeMpId=".concat(yt.key), success: function (t) { var e = t.data || {}, t = e.code, e = e.data; 200 === t && e && (Ot(e.sampling) && (Et = e.sampling, (t = {})[E] = Et, Ct(t)), kt([{ key: "setdataThreshold", storeKey: q, validFunc: Ot }, { key: "setdataTrace", storeKey: O, validFunc: Ft }, { key: "setdataTraceHint", storeKey: F, validFunc: Ft }, { key: "ignoreErrorCodes", storeKey: N, validFunc: Nt }, { key: "setdataTimeInterval", storeKey: M, validFunc: Mt }], e)) }, complete: function () { t && t(Et) } }) } function jt() { Et = Et || (+yt.sampleRate || 1); var t = Math.random(); qt = t <= Et } function Pt(t, e) { return function () { if (Z(e)) try { e.apply(this, arguments) } catch (t) { } if (Z(t)) return t.apply(this, arguments) } } function Lt(e, n, r) { return function () { var t; if (Z(n)) try { n.apply(this, arguments) } catch (t) { } if (Z(e) && (t = e.apply(this, arguments)), Z(r)) try { r.apply(this, arguments) } catch (t) { } return t } } function wt(t, e) { var n, r; Q(t) && Z(t.handler) && (n = t.name, r = t.handler, t = t.afterHandler, e[n] = Lt(e[n], r, t), e[n]._ty_hook = !0) } function Ht() { return (getCurrentPages() || []).map(function (t) { return t.route }) } function Kt() { var t = Ht(); return 0 < t.length ? t[t.length - 1] : "" } function Ut(t) { return t && J(t) ? JSON.parse(t) : t } function zt(t) { try { return Ut(t) } catch (t) { } return null } function Gt() { for (var t = 0; t < arguments.length; t++)if (null != arguments[t]) return arguments[t] } function Yt() { return { uniqueId: 0, requestId: 0, apiId: 0, otherActions: [], eventActions: [], setData: { threshold: Gt(yt.setdataThreshold, xt(q), A), setDataTrace: Gt(yt.setdataTrace, xt(O), x), setDataTraceHint: Gt(yt.setdataTraceHint, xt(F), C), setDataTimeInterval: Gt(yt.setdataTimeInterval, xt(M), R), stuck: !1, max: 0, currentSegmentTime: 0, data: {}, requestBridge: [] }, reqStat: { currentSegmentTime: 0, data: {} }, lastSetDataInOnReady: 0, stuck: !1, jsError: !1, netError: !1, recordFirstLoad: !1 } } function Bt() { return { stuck: !1, firstLoad: 0, jsError: !1, netError: !1 } } setInterval(Rt, It); var Vt = {}, $t = [], Jt = 0, Xt = {}, Zt = Yt(), Qt = Bt(), Wt = { canSend: !1, sent: !1, apiRemain: 0, needClearDeferredData: !1 }; function te() { Vt = {}, $t = [], Jt = 0, Wt.apiRemain = 0, Zt = Yt(), Wt.needClearDeferredData = !0 } function ee() { Qt = Bt() } function ne(t) { var e; Zt.eventActions || (Zt.eventActions = []), Zt.otherActions || (Zt.otherActions = []), t && (t.type === b ? (e = yt && yt.eventMaxSize || T, Zt.eventActions && Zt.eventActions.length >= e && Zt.eventActions.shift(), Zt.eventActions.push(t)) : Zt.otherActions.push(t)) } function re(t, e) { for (var n in e) At(e, n) && e[n] && 0 < e[n].count && t.push(Object.assign(e[n] || {}, { timestamp: +n })) } function ae() { var t = [], e = []; re(t, Zt.setData.data), re(e, Zt.reqStat.data); var n = { metric: { jsError: $t && 0 < $t.length, netError: Zt.netError, stuck: Zt.stuck } }; return 0 < t.length && (n.setData = { threshold: Gt(Zt.setData.threshold, A), setDataTrace: Gt(Zt.setData.setDataTrace, x), setDataTraceHint: Gt(Zt.setData.setDataTraceHint, C), setDataTimeInterval: Gt(Zt.setData.setDataTimeInterval, R), max: Zt.setData.max, requestBridge: Zt.setData.requestBridge, data: t }), 0 < e.length && (n.reqStat = e), !Vt.onLoad || (e = (e = Zt.lastSetDataInOnReady) || Vt.onReady) && (e = 0 < (e = e - Vt.onLoad) ? e : 0, n.metric.firstLoad = e), Qt = n.metric, n } function oe() { Jt = l() } var ie = { uid: ce(), sid: st(), v: "1.3.11-sgcc.3", at: "my" }; function ce() { var t = r(m); return t || (t = st(), o(m, t)), t } function se(t) { var e; qt && ((e = Object.assign({}, ie, s || {}, { key: yt.key }, t || {})).launch = !t, e.launch && (e.launchOptions = p.launchOptions), de("/mp-app", e)) } function ue(t) { var e; qt && (v === t && (Wt.canSend = !0), !Wt.sent && Wt.canSend && (e = Object.assign({}, { path: Xt.current, pageEvent: Object.assign({}, Vt), errs: $t.slice(), fromPath: Xt.prev || "", actions: (Zt.eventActions || []).concat(Zt.otherActions || []) }, Object.assign({}, ie, s || {}, { key: yt.key }), 0 < Jt ? { ct: Jt } : {}, ae()), (t = h()) && (e.routeTrack = t), de("/mp-page", e), te(), Wt.sent = !0, Wt.canSend = !1)) } function de(t, e) { e = pt({ url: t, body: e, bodySep: V }); St.add({ uri: e.url, data: e.body }) } function he(t) { jt(); try { a.getNetworkType({ success: function (t) { s.networkType = t.networkType }, complete: function () { t && t() } }) } catch (t) { } } function fe(t) { var e = t.path, n = t.query, r = t.scene; s.openPath = e, yt.disableFetchQuery || (s.query = n), s.scene = r, p.launchOptions = t, he(function () { se() }) } function le(t) { var e = "", n = ""; J(t) ? e = t : t && (e = t.stack, n = t.message), e && (e = { time: l(), stack: e }, n && (e.msg = n), $t.push(e)) } function pe() { var t = h(); d(); var e = Xt.current; Xt.prev = "", Xt.current = "", se({ routeTrack: t, closePath: e, metric: Qt }) } function ye() { return !0 } var me = [{ name: "onLaunch", handler: fe }, { name: "onError", handler: le }, { name: "onHide", handler: pe }]; function ge(e) { return me.forEach(function (t) { wt(t, e) }), e } function ve(t) { return t } function Te() { var e = App; App = function (t) { if (t = ge(t), e) return e.call(this, t) } } function be(t) { return yt.ignoredPages && X(yt.ignoredPages) ? yt.ignoredPages.indexOf(t) < 0 : !yt.pages || !X(yt.pages) || -1 < yt.pages.indexOf(t) } function De(t, e) { if (!Q(e)) return t; try { var n = Object.keys(e).map(function (t) { return "".concat(t, "=").concat(e[t]) }).join("&"); n && (t += "?".concat(n)) } catch (t) { } return t } function _e() { var s = this.setData, u = Zt.setData.threshold, d = Zt.setData.setDataTrace, h = Zt.setData.setDataTraceHint, f = Zt.setData.setDataTimeInterval; this.setData = function () { var r = arguments[0], a = arguments[1], t = l(), o = { start: t }, i = p.context, c = i && i.type === D && i.data && i.data.recordFirstLoad; (Zt.recordFirstLoad || c) && (o.calcFirstLoad = !0); try { var e = Zt.setData.currentSegmentTime; 1e3 < t - e ? (Zt.setData.currentSegmentTime = t, Zt.setData.data[t] = { count: 0, grade: { good: { count: 0 }, normal: { count: 0 }, bad: { count: 0 } }, traces: [] }, o.segmentTime = t) : o.segmentTime = e } catch (t) { } function n() { try { o.end = l(), o.calcFirstLoad && o.end > Zt.lastSetDataInOnReady && (Zt.lastSetDataInOnReady = o.end), o.duration = o.end - o.start; var t = Zt.setData.data[o.segmentTime]; if (t.count++, o.duration > Zt.setData.max && (Zt.setData.max = o.duration), o.duration > f[1] ? t.grade.bad.count++ : o.duration > f[0] ? t.grade.normal.count++ : t.grade.good.count++, o.duration > u && (Zt.stuck || (Zt.stuck = !0), t.traces.length < k && d)) try { var e = et(r, !0), n = { timestamp: o.start, duration: o.duration, size: e.value.length }; h && (n.hint = e.value.substring(0, 200)), e.error && (n.error = e.error), t.traces.push(n) } catch (t) { } c && Zt.setData.requestBridge.push({ start: o.start, end: o.end, requestId: i.data.requestId, url: i.data.url }) } catch (t) { } return a && a.apply(this, arguments) } return s.call(this, arguments[0], n) } } function Se() { be(this.route) && (Wt.needClearDeferredData && (ee(), Wt.needClearDeferredData = !1), Zt.recordFirstLoad = !0, _e.call(this), Vt.onLoad = l(), this[L] = De(this.route, arguments[0])) } function Ae() { var t; be(this.route) && (Wt.needClearDeferredData && (ee(), Wt.needClearDeferredData = !1), Vt.onShow = l(), u(t = this[L] || this.route), Xt.prev = Xt.current, Xt.current = t, Wt.sent = !1) } function xe() { be(this.route) && (Vt.onReady = l()) } function Ce() { be(this.route) && (Zt.recordFirstLoad = !1) } function ke() { be(this.route) && (Vt.onHide = l(), ue(v)) } function Ie() { be(this.route) && (Vt.onUnload = l(), ue(v)) } var Ee = [{ name: "onLoad", handler: Se }, { name: "onShow", handler: Ae }, { name: "onReady", handler: xe, afterHandler: Ce }, { name: "onHide", handler: ke }, { name: "onUnload", handler: Ie }]; function qe(t, e) { for (var n in t) { var r; At(t, n) && Z(t[n]) && !t[n]._ty_hook && Z(e) && (r = t[n], t[n] = e.call(this, n, r), t[n]._ty_hook = !0) } } var Oe = [D, _, S]; function Fe() { var e = {}; return Oe.forEach(function (t) { e[t] = { current: 0, children: 0 } }), e } function Ne(t, e) { for (var n = 0; n < t.length; n++)if (t[n].cid === e.id) { e.requests && 0 < e.requests.length && (t[n].requests = e.requests), e.apis && 0 < e.apis.length && (t[n].apis = e.apis); break } } function Me(t) { t = t || {}, this.id = ++Zt.uniqueId, this.parent = t.parent || null, this.name = t.name || "<root>", this.type = t.type || b, this.subType = this.type === b ? t.subType || "tap" : t.subType, this.requests = [], this.apis = [], this.remain = Fe(), this.s = l(), this.e = null, this.data = t.data || {}, this.closed = !1, this.path = Xt.current, this.prevPath = Xt.prev, this.dataComposed = t.dataComposed || !1 } Me.prototype.end = function (t) { var e; this.closed || (t && ((e = this.getItemsByType(t.type)) && 0 < e.length && Ne(e, t), this.updateRemain(-1, t.type)), this.isNoRemain() && (this.e = l(), this.closed = !0, this.parent ? this.parent.end(this) : (ne(this.composeActionData()), p.context = null))) }, Me.prototype.getItemsByType = function (t) { var e; return t === D ? e = this.requests : t === _ && (e = this.apis), e }, Me.prototype.isNoRemain = function (t) { var e, n = !0; for (e in this.remain) if (At(this.remain, e)) if (!(this.remain[e].current <= 0 && (!!t || this.remain[e].children <= 0))) { n = !1; break } return n }, Me.prototype.setData = function (t) { Object.assign(this.data, t) }, Me.prototype.hasPrevAssignedData = function () { return this.requests && 0 < this.requests.length || this.apis && 0 < this.apis.length }, Me.prototype.composeActionData = function () { var t = { id: this.id, name: this.name, type: this.type, start: this.s, end: this.e, duration: 0 < this.e - this.s ? this.e - this.s : 0, path: this.path, prevPath: this.prevPath }; return this.requests && 0 < this.requests.length && (t.requests = this.requests), this.apis && 0 < this.apis.length && (t.apis = this.apis), this.data && (t.data = this.data), this.type !== D && this.type !== _ || (delete (t = Object.assign({}, t, this.data)).data, this.type === D && delete t.name), t }, Me.prototype.canEnd = function () { return this.isNoRemain(!0) }, Me.prototype.isEventChildContext = function () { for (var t = this.parent, e = !1; null != t;) { if (t.type === b) { e = !0; break } t = t.parent } return e }, Me.prototype.updateRemain = function (t, e) { var n = t || 0; this.remain[e = e || D].current = this.remain[e].current + n; for (var r = this.parent; r;)r.remain[e].children = r.remain[e].children + n, r = r.parent }, Object.defineProperty(Me.prototype, "current", { get: function () { return p.context }, enumerable: !0, configurable: !0 }); var Re = "tyname"; function je(t) { return !t || "tap" !== t.type || !Q(t.target) || !Q(t.currentTarget) || null == t.timeStamp } function Pe(t, e) { var n = t.target || {}, r = n.offsetLeft, a = n.offsetTop, o = n.id, i = n.dataset, c = t.detail || {}, n = c.x, c = c.y; t._relatedInfo && (s = t._relatedInfo.anchorTargetText); var s = { target: { offsetLeft: r, offsetTop: a, id: o, x: n, y: c }, dataset: { name: i[Re], targetName: s, methodName: e } }; p.context = new Me({ name: e || "", type: b, subType: t.type, data: s, dataComposed: !0 }) } function Le() { p.context && p.context.canEnd() && p.context.end(), p.context = null } function we(r, a) { return function () { var t, e = arguments[0] || {}, n = je(e); if (!n) try { Pe.call(this, e, r) } catch (t) { } try { t = a.apply(this, arguments) } finally { if (!n) try { Le.call(this) } catch (t) { } } return t } } function He(e) { var n = p.context; return function () { var t; p.context = n; try { t = e.apply(this, arguments) } finally { p.context = null } return t } } function Ke(e, t) { if (!e || e[w]) return e; t = t || {}, e.methods || (e.methods = {}); t = (null != t.disbaleComponentLifeCycleHook ? t : yt).disbaleComponentLifeCycleHook; return null != t && !1 !== t || Ee.forEach(function (t) { wt(t, e.methods) }), qe(e.methods, we), e[w] = !0, e } function Ue(t, e) { return Tt() ? Ke.apply(this, arguments) : t } function ze(t, e) { t && t.context && t.context.parent && (t.pcid = t.context.parent.id, t.context.parent.updateRemain(1, e), e === D ? t.context.parent.requests.push(t.context.data) : e === _ && t.context.parent.apis.push(t.context.data)) } function Ge(t) { p.context = t.context } function Ye(t) { (t = t || p.context) && t.canEnd() && t.end() } var Be = "success", Ve = "fail", $e = "complete"; function Je(t, e) { var n = l(), r = e(), e = l(); return t.cbTime += e - n, r } function Xe(a, t, e) { var o = e.cbHook || {};[Be, Ve, $e].forEach(function (n) { var r = t[n]; t[n] = He(function () { a.end || (a.end = l()), Ge(a); try { if (r) { var t = arguments, e = this; return Je(a, function () { return r.apply(e, t) }) } } finally { o[n] && o[n].apply(this, arguments), n === $e && Ze(a) } }) }) } function Ze(t) { t.context && (t.context.dataComposed = !0), Ye(t.context) } function Qe(t) { t.context || (t.context = new Me({ parent: p.context, name: "".concat(t.url, "-").concat(t.requestId), type: D }), t.cid = t.context.id) } function We() { var t = l(), e = Zt.reqStat.currentSegmentTime; 1e3 < t - e && (Zt.reqStat.currentSegmentTime = e = t, Zt.reqStat.data[t] = { count: 0 }), Zt.reqStat.data[e].count++ } function tn(t, e, n) { e = yt[e]; if (Z(e)) try { var r = e.call(null, n); Q(r) && t.context.setData({ custom: r }) } catch (t) { } } function en(t, e) { t.statusCode = i(e); var n = !1; 400 <= t.statusCode && (yt.ignoreErrorCodes || []).indexOf(t.statusCode) < 0 ? (n = !0, t.failMessage = at(e.data, yt.requestFailMessageSize)) : e.errMsg && !t.statusCode && (n = !0, t.failMessage = e.errMsg.substring(0, yt.requestFailMessageSize)), !t.statusCode && e.errCode && (t.statusCode = e.errCode), t.requestErr = n } var nn = n(), rn = a[nn]; function an(t, e) { if (!t) return null; return zt(t["X-Tingyun-Data"]) } function on(t, e) { yt.id && (t.header = t.header || {}, t.header["X-Tingyun"] = "c=B|".concat(yt.id)) } function cn(t) { if (!t) return 0; var e = t.header, n = t.data, t = 0; return t = !(t = +(e && e["Content-Length"])) || !tt(t) || Number.isNaN(t) ? rt(n) || 0 : t } function sn(t, e, n) { e = an(t.header, e.r); e && (n.s_id = e.id, n.s_name = e.tname, n.t_id = e.tid, n.s_du = e.duration, "user" in e && (n.s_user = e.user)) } function un(t, e, n) { sn(n, t, t.context.data), t.context.setData({ end: t.end, cbTime: t.cbTime, duration: 0 < t.end - t.start ? t.end - t.start : 0, send: rt(e.data), rec: cn(n), statusCode: t.statusCode || 0, failMessage: t.failMessage, status: t.status || U }) } var dn = function () { var n, r = arguments[0] || {}; return !r._no_record && r.url && Tt() && (We(), Qe(n = { requestId: ++Zt.requestId, cbTime: 0, start: l(), url: r.url }), n.context.setData({ type: D, requestId: n.requestId, cid: n.cid, url: n.url, method: r.method && r.method.toUpperCase() || K, recordFirstLoad: Zt.recordFirstLoad, start: n.start }), ze(n, D), on(r), Xe(n, r, { cbHook: { complete: function (t) { var e = t; en(n, e = t || {}), n.requestErr && (Zt.netError = !0, n.status = z), tn(n, g, t), un(n, r, e) } } })), rn.apply(this, arguments) }; function hn() { Object.defineProperty(a, nn, { configurable: !0, enumerable: !0, writable: !0, value: dn }) } function fn(e) { return Ee.forEach(function (t) { wt(t, e) }), qe(e, we), e[y] = oe, e } function ln(t) { return t } function pn() { var e = Page; Page = function (t) { if (t = fn(t), e) return e.call(this, t) } } function yn(t) { s.uid = t, o(m, t) } function mn() { return s.uid } var gn = function () { function e(t) { if (t.length < 2) return (e = t.charCodeAt(0)) < 128 ? t : e < 2048 ? s(192 | e >>> 6) + s(128 | 63 & e) : s(224 | e >>> 12 & 15) + s(128 | e >>> 6 & 63) + s(128 | 63 & e); var e = 65536 + 1024 * (t.charCodeAt(0) - 55296) + (t.charCodeAt(1) - 56320); return s(240 | e >>> 18 & 7) + s(128 | e >>> 12 & 63) + s(128 | e >>> 6 & 63) + s(128 | 63 & e) } function n(t) { var e = [0, 2, 1][t.length % 3], t = t.charCodeAt(0) << 16 | (1 < t.length ? t.charCodeAt(1) : 0) << 8 | (2 < t.length ? t.charCodeAt(2) : 0); return [i.charAt(t >>> 18), i.charAt(t >>> 12 & 63), 2 <= e ? "=" : i.charAt(t >>> 6 & 63), 1 <= e ? "=" : i.charAt(63 & t)].join("") } function r(t) { return "[object Uint8Array]" === Object.prototype.toString.call(t) ? t.toString("base64") : h(d(String(t))) } function a(t, e) { return e ? r(String(t)).replace(/[+\/]/g, function (t) { return "+" == t ? "-" : "_" }).replace(/=/g, "") : r(t) } function o(t) { switch (t.length) { case 4: var e = ((7 & t.charCodeAt(0)) << 18 | (63 & t.charCodeAt(1)) << 12 | (63 & t.charCodeAt(2)) << 6 | 63 & t.charCodeAt(3)) - 65536; return s(55296 + (e >>> 10)) + s(56320 + (1023 & e)); case 3: return s((15 & t.charCodeAt(0)) << 12 | (63 & t.charCodeAt(1)) << 6 | 63 & t.charCodeAt(2)); default: return s((31 & t.charCodeAt(0)) << 6 | 63 & t.charCodeAt(1)) } } var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", c = function (t) { for (var e = {}, n = 0, r = t.length; n < r; n++)e[t.charAt(n)] = n; return e }(i), s = String.fromCharCode, u = /[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g, d = function (t) { return t.replace(u, e) }, h = function (t) { return t.replace(/[\s\S]{1,3}/g, n) }, f = new RegExp(["[À-ß][-¿]", "[à-ï][-¿]{2}", "[ð-÷][-¿]{3}"].join("|"), "g"), l = function (t) { return t.replace(f, o) }, p = function (t) { var e = t.length, n = e % 4, t = (0 < e ? c[t.charAt(0)] << 18 : 0) | (1 < e ? c[t.charAt(1)] << 12 : 0) | (2 < e ? c[t.charAt(2)] << 6 : 0) | (3 < e ? c[t.charAt(3)] : 0), t = [s(t >>> 16), s(t >>> 8 & 255), s(255 & t)]; return t.length -= [0, 0, 2, 1][n], t.join("") }, y = function (t) { return t.replace(/\S{1,4}/g, p) }; return { atob: function (t) { return y(String(t).replace(/[^A-Za-z0-9\+\/]/g, "")) }, btoa: h, utob: d, encode: a, encodeURI: function (t) { return a(t, !0) }, btou: l, decode: function (t) { return t = String(t).replace(/[-_]/g, function (t) { return "-" == t ? "+" : "/" }).replace(/[^A-Za-z0-9\+\/]/g, ""), l(y(t)) } } }(), vn = "ty-auth-token", Tn = "ty-auth-type"; function bn(t, e, n) { null == t[e] && (t[e] = n) } function Dn(t) { t = t || "p35OnrDoP8k"; for (var e = gn.encode("".concat(l(), "_").concat(t)), n = Math.floor(8 * Math.random() + 1), t = e.substring(0, n), r = e.split(""), a = t.split(""), o = r.length - 1; 0 <= o && (r.splice(o + 1, 0, a.shift()), o -= 2, 0 !== a.length);); for (; 0 < a.length;)r.unshit(a.shift()); for (var t = r.join(""), i = gn.encode(t), c = i.length - 1; "=" === i[c];)c--; return i.substring(0, c + 1) + n + i.substring(c + 1) } function _n(t) { var e; return e = t && t.headers && t.headers[vn] ? t.headers[vn] : e } function Sn() { if (yt.sgcc_beacon) { var t = "".concat(yt.sgcc_beacon, "/login"), e = { "content-type": "text/plain;charset=UTF-8" }; e[Tn] = "mp_alipay"; try { var n = Dn(yt.key); St.add({ url: t, data: n, header: e, complete: function (t) { try { var e = _n(t); e && (p.sgccTrackSid = e) } catch (t) { } } }) } catch (t) { } } } function An(e) { var t, n, r, a, o; yt.sgcc_beacon && (!(t = lt()) && yt.pubKey || (e = e || {}, n = s.scene, o = s.openPath, a = s.system, r = { USER_ACCOUNT_ID: mn() || "", RECORDTIME: nt(l()), PAGENAME: Kt(), $scene: nt(n), $open_path: o }, a && (r.$system_model = a.model, r.$system_os = a.system, r.$system_version = a.version, r.$system_sdk_version = a.SDKVersion), Object.keys(r).forEach(function (t) { bn(e, t, r[t]) }), a = o = et([at(e)]), t && (a = pt({ body: o }).body), o = { "content-type": "text/plain;charset=UTF-8" }, p.sgccTrackSid && (o[vn] = p.sgccTrackSid), St.add({ url: yt.sgcc_beacon, data: a, header: o }))) } function xn() { return p.context } var Cn, kn = { version: "1.3.11-sgcc.3", setUser: yn, hookApp: ve, hookPage: ln, hookComponent: Ue, request: dn, getContext: xn, setReleaseId: f, plugin: !1 }, In = { track: An }; Object.assign(kn, In); var En = ["success", "fail"], qn = [], On = { requestPayment: { fail: function () { var t = arguments && arguments[0], e = "fail"; return e = t && Q(t) && "requestPayment:fail cancel" === t.errMsg ? "cancel" : e } } }; function Fn() { (Cn = yt.hookApis || e()).forEach(function (t) { -1 < qn.indexOf(t) || "request" === t || qn.push(t) }) } function Nn(t) { return { apiId: t.apiId, type: _, name: t.name, success: t.success || 0, fail: t.fail || 0, cancel: t.cancel || 0, start: t.start, end: t.end, duration: 0 < t.end - t.start ? t.end - t.start : 0, count: 1, failMessage: t.failMessage, cid: t.cid } } function Mn(t) { var e; t.context || (e = "".concat(t.name, "-").concat(t.apiId), t.context = new Me({ parent: p.context, name: e, type: _ }), t.cid = t.context.id) } function Rn(r) { var e = a[r]; return function () { var t = arguments[0] || {}, n = { apiId: ++Zt.apiId, name: r, start: l() }; return Mn(n), ze(n, _), En.forEach(function (e) { t[e] = He(Pt(t[e], function () { var t; n.end || (n.end = l()), Ge(n), (t = On[r] && On[r][e] && Z(On[r][e]) ? On[r][e].apply(this, arguments) : e) && (n[t] = 1), "fail" === t && (n.failMessage = at(arguments && arguments[0], yt.apiFailMessageSize)) })) }), t.complete = He(Lt(t.complete, function () { n.end || (n.end = l()), Ge(n) }, function () { n.context && (n.context.setData(Nn(n)), n.context.dataComposed = !0), Ye() })), e.apply(this, arguments) } } function jn(t) { t && a[t] && Object.defineProperty(a, t, { configurable: !0, enumerable: !0, writable: !0, value: Rn(t) }) } function Pn() { Cn || Fn(); var e = {}; return qn.forEach(function (t) { e[t] = Rn(t) }), e } function Ln() { Cn || Fn(), qn.forEach(function (t) { jn(t) }) } function wn() { hn() } function Hn(t) { t && !ye() || (Te(), pn(), wn(), Ln()), t && Object.assign(kn, Pn() || {}), Sn() } function Kn(t) { Tt() || (vt(t || {}), bt(!0), Rt(), t = !0, Hn(t = null != yt.plugin ? yt.plugin : t)) } function Un() { return kn.config = Kn, kn } a.onNetworkStatusChange(function (t) { s.networkType = t.networkType }); var zn = Un(); module.exports = zn;